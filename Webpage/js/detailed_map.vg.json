{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Detailed map of bushfires",
  "width": 800,
  "height": 500,
  "projection": {
    "parallels": [-16, -37],
    "rotate": [-130, 0, 0],
    "type": "conicEqualArea"
  },
  "params": [
    {
      "name": "min_area", "value": 0,
      "bind":{"input": "range","min": 0,"max": 5,"step": 0.5, "name": "Minimum Area: "}
    },
    {
      "name": "min_intensity", "value": 0,
      "bind":{"input": "range","min": 0,"max": 300, "step": 50, "name": "Minimum Intensity: "}
    },
    {
      "name": "month_select",
      "bind":{
        "input": "select",
        "options": [
          null,
          "05",
          "06",
          "07",
          "08",
          "09"
        ],
        "labels": [
          "Show all",
          "May",
          "June",
          "July",
          "August",
          "September"
        ],
        "name": "Select Month: "
      }
    }
  ],
  "layer": [
    {
      "data": {
        "url": "js/map_australia.topojson",
        "format": {"type": "topojson", "feature": "austates"}
      },
      "mark": {"type": "geoshape", "stroke": "black"},
      "encoding": {
        "color": {
          "value": "lightgray"
        },
        "tooltip": [
          {"field": "id", "type": "nominal"}
          ]
      }
    },
    {
      "data": {"url": "data/fire_nrt_M-C61_221759.csv"},
      "transform": [
        {"calculate": "substring(datum.ACQ_DATE, 1, 5)", "as": "fire_year"},
        {"calculate": "substring(datum.ACQ_DATE, 6, 8)", "as": "fire_month"},
        {"calculate": "substring(datum.ACQ_DATE, 9, 11)", "as": "fire_day"},
        {"calculate": "(datum.SCAN * datum.TRACK) ", "as": "fire_area"},
        {"calculate": "datum.BRIGHTNESS / (datum.SCAN * datum.TRACK) ", "as": "fire_intensity"},
        {"filter": "datum.fire_area > min_area"},
        {"filter": "datum.fire_intensity > min_intensity"},
        {"filter": "month_select == null || datum.fire_month == month_select"}
      ],
      "mark": {"type": "point", "tooltip":{"content": "data"}},
      "encoding": {
        "latitude": {
          "field": "LATITUDE",
          "type": "quantitative"
        },
        "longitude": {
          "field": "LONGITUDE",
          "type": "quantitative"
        },
        "color": {
          "field": "fire_intensity",
          "type": "quantitative",
          "title": "Fire Intensity",
          "scale": {
            "type": "threshold",
            "domain": [100, 150, 200, 250],
            "scheme": "Reds"
          },
          "legend": {"format": ".2s"}
        },
        "opacity": {"value": 0.6},
        "size": {
          "field": "fire_area",
          "type": "quantitative",
          "title": "Fire Area",
          "scale": {
            "type": "threshold",
            "domain": [1, 2, 3, 4, 5],
            "range": [5, 10, 50, 100, 200, 300]
          },
          "legend": {"format": ".1s"}
        }
      }
    }
  ]
}
